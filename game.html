<!DOCTYPE html>
<html>
<head>
    <title>3D Minecraft Maze</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: sans-serif; }
        #click-to-start { position: absolute; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; cursor: pointer; color: white; text-align: center; }
        canvas { display: block; }
        #ui { position: absolute; top: 10px; left: 10px; color: #0f0; z-index: 50; pointer-events: none; font-family: monospace; }
    </style>
</head>
<body>
    <div id="ui">LEVEL 1 | FIND THE GOLD</div>
    <div id="click-to-start">
        <h1>üñ±Ô∏è CLICK TO PLAY</h1>
        <p>W,A,S,D to Walk | Mouse to Look</p>
    </div>
    <canvas id="gameCanvas"></canvas>
    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const startScreen = document.getElementById("click-to-start");
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // FIXED MAP: 1=Wall, 0=Path, 2=Gold Goal
        const map = [
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 0, 1, 1, 1, 1, 1, 1, 0, 1],
            [1, 0, 1, 0, 0, 0, 0, 1, 0, 1],
            [1, 0, 1, 0, 1, 1, 0, 1, 0, 1],
            [1, 0, 0, 0, 1, 2, 0, 0, 0, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
        ];

        const tileSize = 64;
        let player = { x: 96, y: 96, angle: 0 };
        let keys = {};
        let gameActive = false;

        // Pointer Lock Controls
        startScreen.onclick = () => { canvas.requestPointerLock(); };
        document.addEventListener("pointerlockchange", () => {
            gameActive = (document.pointerLockElement === canvas);
            startScreen.style.display = gameActive ? "none" : "flex";
        });

        document.onmousemove = (e) => { 
            if(gameActive) player.angle += e.movementX * 0.003; 
        };

        window.onkeydown = (e) => keys[e.key.toLowerCase()] = true;
        window.onkeyup = (e) => keys[e.key.toLowerCase()] = false;

        function loop() {
            if(gameActive) {
                let nx = player.x, ny = player.y;
                let moveSpeed = 3;
                if(keys['w']) { nx += Math.cos(player.angle)*moveSpeed; ny += Math.sin(player.angle)*moveSpeed; }
                if(keys['s']) { nx -= Math.cos(player.angle)*moveSpeed; ny -= Math.sin(player.angle)*moveSpeed; }
                if(keys['a']) { nx += Math.sin(player.angle)*moveSpeed; ny -= Math.cos(player.angle)*moveSpeed; }
                if(keys['d']) { nx -= Math.sin(player.angle)*moveSpeed; ny += Math.cos(player.angle)*moveSpeed; }
                
                let tx = Math.floor(nx/tileSize);
                let ty = Math.floor(ny/tileSize);
                if(map[ty][tx] === 0 || map[ty][tx] === 2) { 
                    player.x = nx; player.y = ny; 
                }
                if(map[ty][tx] === 2) {
                    alert("YOU FOUND THE GOLD!");
                    location.reload();
                }
            }

            // Draw Sky and Floor
            ctx.fillStyle = "#111"; ctx.fillRect(0,0,canvas.width,canvas.height/2);
            ctx.fillStyle = "#222"; ctx.fillRect(0,canvas.height/2,canvas.width,canvas.height/2);

            // Raycasting
            const fov = Math.PI / 3;
            const rays = canvas.width / 4;
            for(let i=0; i<rays; i++) {
                let ra = (player.angle - fov/2) + (i / rays) * fov;
                let d = 0, hit = 0;
                while(hit == 0 && d < 1000) {
                    d += 2;
                    let tx = Math.floor((player.x + Math.cos(ra)*d)/tileSize);
                    let ty = Math.floor((player.y + Math.sin(ra)*d)/tileSize);
                    if(map[ty] && map[ty][tx] > 0) hit = map[ty][tx];
                }
                let hh = (tileSize * canvas.height) / (d * Math.cos(ra - player.angle));
                let shade = Math.max(0, 255 - (d / 4));
                ctx.fillStyle = hit === 2 ? `rgb(${shade}, ${shade*0.8}, 0)` : `rgb(0, ${shade}, ${shade/3})`;
                ctx.fillRect(i*4, (canvas.height-hh)/2, 4, hh);
            }
            requestAnimationFrame(loop);
        }
        loop();
    </script>
</body>
</html>
