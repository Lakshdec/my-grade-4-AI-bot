<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>3D Maze Game</title>
    <style>
        body { margin: 0; background: #000; color: #0f0; font-family: sans-serif; overflow: hidden; }
        #ui { position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.8); padding: 15px; border-radius: 10px; border: 2px solid #0f0; pointer-events: none; z-index: 10; }
        #hint-display { color: gold; margin-top: 10px; font-weight: bold; font-family: monospace; }
        #win-msg { display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: gold; font-size: 3em; background: rgba(0,0,0,0.9); padding: 20px; border: 5px solid gold; border-radius: 20px; z-index: 20; }
        canvas { display: block; }
    </style>
</head>
<body>
    <div id="ui">
        <b>üìê 3D RAYCAST ENGINE</b><br>
        W,S: Move | A,D: Turn<br>
        <div id="hint-display">WAITING FOR BOT...</div>
    </div>
    <div id="win-msg">üèÜ YOU FOUND THE GOLD!</div>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const winMsg = document.getElementById("win-msg");
        const hintDisplay = document.getElementById("hint-display");
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const map = [
           ,
           ,
           ,
           ,
           ,
           ,
           ,
           
        ];
        const tileSize = 64;
        let player = { x: 96, y: 96, angle: 0 };
        let keys = {};

        window.addEventListener("keydown", (e) => keys[e.key.toLowerCase()] = true);
        window.addEventListener("keyup", (e) => keys[e.key.toLowerCase()] = false);

        // --- CHECK SECRET MAILBOX ---
        function checkHint() {
            const hint = localStorage.getItem("mazeHint"); // Checks 'mazeHint'
            if (hint) {
                hintDisplay.innerText = "HINT: " + hint;
            }
        }

        function draw() {
            ctx.fillStyle = "#111"; ctx.fillRect(0, 0, canvas.width, canvas.height/2);
            ctx.fillStyle = "#222"; ctx.fillRect(0, canvas.height/2, canvas.width, canvas.height/2);
            const fov = Math.PI / 3;
            const rays = canvas.width / 4;

            for (let i = 0; i < rays; i++) {
                let rayAngle = (player.angle - fov/2) + (i / rays) * fov;
                let dist = 0, hit = 0;
                while (hit === 0 && dist < 1000) {
                    dist += 1;
                    let tx = Math.floor((player.x + Math.cos(rayAngle) * dist) / tileSize);
                    let ty = Math.floor((player.y + Math.sin(rayAngle) * dist) / tileSize);
                    if (ty < 0 || ty >= map.length || tx < 0 || tx >= map.length) hit = 1;
                    else if (map[ty][tx] > 0) hit = map[ty][tx];
                }
                let fixDist = dist * Math.cos(rayAngle - player.angle);
                let h = (tileSize * canvas.height) / fixDist;
                let shade = 255 - (fixDist / 4);
                ctx.fillStyle = (hit === 2) ? `rgb(${shade}, ${shade*0.8}, 0)` : `rgb(0, ${shade}, ${shade/2})`;
                ctx.fillRect(i * 4, (canvas.height - h) / 2, 4, h);
            }
        }

        function update() {
            let nextX = player.x, nextY = player.y;
            if (keys['w']) { nextX += Math.cos(player.angle) * 3; nextY += Math.sin(player.angle) * 3; }
            if (keys['s']) { nextX -= Math.cos(player.angle) * 3; nextY -= Math.sin(player.angle) * 3; }
            if (keys['a']) player.angle -= 0.05;
            if (keys['d']) player.angle += 0.05;

            let tx = Math.floor(nextX / tileSize), ty = Math.floor(nextY / tileSize);
            if (map[ty][tx] === 0) { player.x = nextX; player.y = nextY; winMsg.style.display = "none"; }
            else if (map[ty][tx] === 2) { winMsg.style.display = "block"; }

            checkHint(); // Update from bot hint!
            draw();
            requestAnimationFrame(update);
        }
        update();
    </script>
</body>
</html>
